<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>The Vault â€” Gate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="no-referrer">
  <meta name="robots" content="noindex, nofollow, noarchive" />
  <!-- Strict CSP: no external scripts; only our own page + Google Forms iframe on join.html -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data:;
    frame-src https://docs.google.com;
    connect-src 'self';
    base-uri 'none';
    form-action 'self';
    frame-ancestors 'none';
    upgrade-insecure-requests;
  ">
  <style>
    :root { color-scheme: dark light; }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
         display:grid;place-items:center;min-height:100dvh;background:#0b0d12;color:#eaf0ff;margin:0}
    .card{width:min(560px,92vw);background:#121623;border:1px solid #1f2435;border-radius:18px;padding:28px}
    h1{margin:0 0 6px 0} p{opacity:.85;margin:0 0 16px 0}
    input,button{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #2b3248;background:#0f1424;color:#eaf0ff}
    input{margin:10px 0 12px 0}
    button{cursor:pointer}
    .muted{opacity:.7;font-size:.9rem;margin-top:10px}
  </style>
</head>
<body>
  <main class="card">
    <h1>Enter The Vault</h1>
    <p>Authorized access only. Use the current passphrase.</p>
    <input id="phrase" type="password" autocomplete="off" inputmode="text" placeholder="Passphrase" />
    <button id="enter">Enter</button>
    <p class="muted">All attempts are logged. Never paste secrets here.</p>
  </main>

  <script>
    // Adjust this if your site is in a subfolder, e.g. "/vault"
    const BASE_PATH = '/';
    // Rotate these as needed; keep short and memorable.
    const ALLOWED = ["vaultalpha-2025","truthbot-zero"]; // TODO: replace with your real passphrase(s)
    const TOKEN_KEY = 'vault_token';
    const TOKEN_TTL_MIN = 15;

    function makeToken() {
      const exp = Date.now() + TOKEN_TTL_MIN * 60 * 1000;
      const body = JSON.stringify({ exp, v: 1, rnd: crypto.getRandomValues(new Uint32Array(1))[0] });
      return btoa(body);
    }

    function setToken(t) {
      // session-only; also mirror to a SameSite cookie for defense-in-depth
      sessionStorage.setItem(TOKEN_KEY, t);
      document.cookie = `${TOKEN_KEY}=${t}; Path=${BASE_PATH}; SameSite=Strict; Secure`;
    }

    document.getElementById('enter').addEventListener('click', () => {
      const val = (document.getElementById('phrase').value || '').trim();
      if (!ALLOWED.includes(val)) {
        alert('Access denied.');
        return;
      }
      const tok = makeToken();
      setToken(tok);
      const url = new URL(BASE_PATH.replace(/\/+$/, '') + '/join.html', location.origin);
      url.searchParams.set('t', tok);
      location.href = url.toString();
    });

    // Optional: register SW (blocks caching of Google Forms, etc.)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register(BASE_PATH + 'sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
